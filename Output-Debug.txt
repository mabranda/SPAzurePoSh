Starting Deployment 07/08/2014 15:28:11
Use Cloud Service Name SpAzureService.
Using Storage Account spazurestorage2.
Setting AD Configuration File
Setting SQL Configuration File
Setting SharePoint Configuration File
Installing Active Directory
Installing Active Directory using Configuration Template: C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\Config\SingleVMs\AD-Sample-AutoGen.xml
C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\Config\AD-VNET\NetworkConfig.xml
Affinity group already exists.
C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\Config\AD-VNET\NetworkConfig.xml
Windows Azure MSDN - Visual Studio Ultimate

xml                                                                                                 NetworkConfiguration                                                                               
---                                                                                                 --------------------                                                                               
version="1.0" encoding="utf-8"                                                                      NetworkConfiguration                                                                               
                                                                                                                                                                                                       
                                                                                                                                                                                                       
                                                                                                                                                                                                       
Adding disk Data with size 20
                                                                                                                                                                                                       
                                                                                                                                                                                                       
[VERBOSE] 3:28:58 PM - Begin Operation: New-AzureVM - Create Cloud Service
[VERBOSE] 3:28:59 PM - Completed Operation: New-AzureVM - Create Cloud Service
                                                                                                                                                                                                       
[VERBOSE] 3:28:59 PM - Begin Operation: New-AzureVM - Create Deployment with VM SpAzureDC1
[VERBOSE] 3:29:33 PM - Completed Operation: New-AzureVM - Create Deployment with VM SpAzureDC1
                                                                                                                                                                                                       
[VERBOSE] 3:29:33 PM - InstanceStatus is RoleStateUnknown
[VERBOSE] 3:31:36 PM - InstanceStatus is Provisioning
[VERBOSE] 3:35:40 PM - InstanceStatus is ReadyRole
Installing WinRM Certificate for remote access: SpAzureService SpAzureDC1
Pausing for Services to Start

Microsoft DiskPart version 6.3.9600

Copyright (C) 1999-2013 Microsoft Corporation.
On computer: SPAZUREDC1

Disk 2 is now the selected disk.

Virtual Disk Service error:
This disk is already online. 


Disk attributes cleared successfully.

DiskPart succeeded in creating the specified partition.


    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
  100 percent completed


DiskPart successfully formatted the volume.

Disk 2 is now the selected disk.

Virtual Disk Service error:
This disk is already online. 


Disk attributes cleared successfully.

Virtual Disk Service error:
There is not enough usable space for this operation.


There is no volume selected.
Please select a volume and try again.
                                                                                                                                                                                                       
                                                                                                                                                                                                       
Running AD-DS Deployment module to install AD DS...
                                                                                                                                                                                                       
[VERBOSE] Installation started... 
[VERBOSE] Continue with installation?
[VERBOSE] Prerequisite processing started...
[VERBOSE] Prerequisite processing succeeded.
                                                                                                                                                                                                       
[VERBOSE] Installation succeeded.
DC Install mode is 
NewForest
[VERBOSE] Active Directory Domain Services Setup

[VERBOSE] Validating environment and parameters...
[WARNING] Windows Server 2012 R2 domain controllers have a default for the security setting named "Allow cryptography algorithms compatible with Windows NT 4.0" that prevents weaker cryptography algorithms when establishing security channel sessions.

For more information about this setting, see Knowledge Base article 942564 (http://go.microsoft.com/fwlink/?LinkId=104751).


[WARNING] This computer has at least one physical network adapter that does not have static IP address(es) assigned to its IP Properties. If both IPv4 and IPv6 are enabled for a network adapter, both IPv4 and IPv6 static IP addresses should be assigned to both IPv4 and IPv6 Properties of the physical network adapter. Such static IP address(es) assignment should be done to all the physical network adapters for reliable Domain Name System (DNS) operation.


[WARNING] A delegation for this DNS server cannot be created because the authoritative parent zone cannot be found or it does not run Windows DNS server. If you are integrating with an existing DNS infrastructure, you should manually create a delegation to this DNS server in the parent zone to ensure reliable name resolution from outside the domain "SpAzure.com". Otherwise, no action is required.


[VERBOSE] ----------------------------------------
[VERBOSE] The following actions will be performed:
[VERBOSE] Configure this server as the first Active Directory domain controller in a new forest.

The new domain name is "SpAzure.com". This is also the name of the new forest.

The NetBIOS name of the domain is "SPAZURE".

Forest Functional Level: Windows Server 2012

Domain Functional Level: Windows Server 2012

Site: Default-First-Site-Name

Additional Options:
  Read-only domain controller: "No"
  Global catalog: Yes
  DNS Server: Yes

Create DNS Delegation: No

Database folder: F:\NTDS
Log file folder: F:\LOGS
SYSVOL folder: F:\SYSVOL

The DNS Server service will be installed on this computer.
The DNS Server service will be configured on this computer.
This computer will be configured to use this DNS server as its preferred DNS server.

The password of the new domain Administrator will be the same as the password of the local Administrator of this computer.
[VERBOSE] ----------------------------------------
[VERBOSE] Active Directory Domain Services Setup

[VERBOSE] Validating environment and parameters...
[WARNING] Windows Server 2012 R2 domain controllers have a default for the security setting named "Allow cryptography algorithms compatible with Windows NT 4.0" that prevents weaker cryptography algorithms when establishing security channel sessions.

For more information about this setting, see Knowledge Base article 942564 (http://go.microsoft.com/fwlink/?LinkId=104751).


[WARNING] This computer has at least one physical network adapter that does not have static IP address(es) assigned to its IP Properties. If both IPv4 and IPv6 are enabled for a network adapter, both IPv4 and IPv6 static IP addresses should be assigned to both IPv4 and IPv6 Properties of the physical network adapter. Such static IP address(es) assignment should be done to all the physical network adapters for reliable Domain Name System (DNS) operation.


[WARNING] A delegation for this DNS server cannot be created because the authoritative parent zone cannot be found or it does not run Windows DNS server. If you are integrating with an existing DNS infrastructure, you should manually create a delegation to this DNS server in the parent zone to ensure reliable name resolution from outside the domain "SpAzure.com". Otherwise, no action is required.


[VERBOSE] ----------------------------------------
[VERBOSE] The following actions will be performed:
[VERBOSE] Configure this server as the first Active Directory domain controller in a new forest.

The new domain name is "SpAzure.com". This is also the name of the new forest.

The NetBIOS name of the domain is "SPAZURE".

Forest Functional Level: Windows Server 2012

Domain Functional Level: Windows Server 2012

Site: Default-First-Site-Name

Additional Options:
  Read-only domain controller: "No"
  Global catalog: Yes
  DNS Server: Yes

Create DNS Delegation: No

Database folder: F:\NTDS
Log file folder: F:\LOGS
SYSVOL folder: F:\SYSVOL

The DNS Server service will be installed on this computer.
The DNS Server service will be configured on this computer.
This computer will be configured to use this DNS server as its preferred DNS server.

The password of the new domain Administrator will be the same as the password of the local Administrator of this computer.
[VERBOSE] ----------------------------------------
[VERBOSE] Press CTRL-C to: Cancel
[VERBOSE] Active Directory Domain Services is now installed on this computer for the domain "SpAzure.com".

This Active Directory domain controller is assigned to the site "Default-First-Site-Name". You can manage sites with the Active Directory Sites and Services administrative tool.
                                                                                                                                                                                                       
AD-DS Deployment completed...
Configuring SpAzureDC1 with a static internal IP, 10.20.1.4. This will allow stopping the VM later and still retain the IP.
                                                                                                                                                                                                       
DC IP is : 10.20.1.4
Adding Active Directory DNS to VNET
Exporting existing VNet...
Read the configuration file into memory...
Updating existing Dns Server node...
Adding Dns Servers Ref node...
                                                                                                                                                                                                       
                                                                                                                                                                                                       
Updating VNet with Dns Server entry...
                                                                                                                                                                                                       
Installing SQL Server 2012
[ERROR] Import-Module : The specified module 'C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Azure\Azure.psd1' was not loaded because no valid module file was found in any module directory.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SQL\ProvisionSQL.ps1:17 char:1
[ERROR] + Import-Module "C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Az ...
[ERROR] + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[ERROR]     + CategoryInfo          : ResourceUnavailable: (C:\Program File...zure\Azure.psd1:String) [Import-Module], FileNotFoundException
[ERROR]     + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand
[ERROR]  
Installing SQL Server using Configuration Template: C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\Config\SingleVMs\SQL-Sample-AutoGen.xml
[ERROR] Import-Module : The specified module 'C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Azure\Azure.psd1' was not loaded because no valid module file was found in any module directory.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SQL\ProvisionSQL.ps1:33 char:1
[ERROR] + Import-Module 'C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Az ...
[ERROR] + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[ERROR]     + CategoryInfo          : ResourceUnavailable: (C:\Program File...zure\Azure.psd1:String) [Import-Module], FileNotFoundException
[ERROR]     + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand
[ERROR]  
[ERROR] Import-Module : The specified module 'C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Azure\Azure.psd1' was not loaded because no valid module file was found in any module directory.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SQL\ProvisionSqlVm.ps1:42 char:1
[ERROR] + Import-Module 'C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Az ...
[ERROR] + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[ERROR]     + CategoryInfo          : ResourceUnavailable: (C:\Program File...zure\Azure.psd1:String) [Import-Module], FileNotFoundException
[ERROR]     + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand
[ERROR]  
Current subscription: Windows Azure MSDN - Visual Studio Ultimate
Creating VM...
Adding disk Data with size 20
                                                                                                                                                                                                       
Adding disk Log with size 10
                                                                                                                                                                                                       
[VERBOSE] 3:49:43 PM - Completed Operation: Get Deployment
[VERBOSE] 3:49:43 PM - Begin Operation: New-AzureVM - Create VM SpAzureSQL1
[VERBOSE] 3:50:18 PM - Completed Operation: New-AzureVM - Create VM SpAzureSQL1
                                                                                                                                                                                                       
[VERBOSE] 3:50:18 PM - InstanceStatus is RoleStateUnknown
[VERBOSE] 3:52:22 PM - InstanceStatus is Provisioning
[VERBOSE] 4:00:33 PM - InstanceStatus is ReadyRole
VM created.
Installing WinRM Certificate for remote access: SpAzureService SpAzureSQL1
Pausing for Services to Start
Formatting data disks

Microsoft DiskPart version 6.2.9200

Copyright (C) 1999-2012 Microsoft Corporation.
On computer: SPAZURESQL1

Disk 3 is now the selected disk.

Virtual Disk Service error:
This disk is already online. 


Disk attributes cleared successfully.

DiskPart succeeded in creating the specified partition.


    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
  100 percent completed


DiskPart successfully formatted the volume.

Disk 3 is now the selected disk.

Virtual Disk Service error:
This disk is already online. 


Disk attributes cleared successfully.

Virtual Disk Service error:
There is not enough usable space for this operation.


There is no volume selected.
Please select a volume and try again.
Enabling CredSSP on SpAzureSQL1
Enabling CredSSP Server...
Auth
    Basic = false
    Kerberos = true
    Negotiate = true
    Certificate = false
    CredSSP = true
    CbtHardeningLevel = Relaxed

CredSSP Server is enabled.
Pausing to Allow CredSSP Scheduled Task to Execute on SpAzureSQL1
[ERROR] [spazureservice.cloudapp.net] Connecting to remote server spazureservice.cloudapp.net failed with the following error message : The WinRM client cannot process the request. CredSSP authentication is 
[ERROR] currently disabled in the client configuration. Change the client configuration and try the request again. CredSSP authentication must also be enabled in the server configuration. Also, Group Policy 
[ERROR] must be edited to allow credential delegation to the target computer. Use gpedit.msc and look at the following policy: Computer Configuration -> Administrative Templates -> System -> Credentials 
[ERROR] Delegation -> Allow Delegating Fresh Credentials.  Verify that it is enabled and configured with an SPN appropriate for the target computer. For example, for a target computer name 
[ERROR] "myserver.domain.com", the SPN can be one of the following: WSMAN/myserver.domain.com or WSMAN/*.domain.com For more information, see the about_Remote_Troubleshooting Help topic.
[ERROR]     + CategoryInfo          : OpenError: (spazureservice.cloudapp.net:String) [], PSRemotingTransportException
[ERROR]     + FullyQualifiedErrorId : -2144108126,PSSessionStateBroken
Installing SharePoint Server 2013
Installing SharePoint Server 2013 using Configuration Template: C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\Config\SingleVMs\SharePoint-Sample-AutoGen.xml
[VERBOSE] Performing the operation "New" on target "CN=SpAzureAppPool,OU=ServiceAccounts,DC=SpAzure,DC=com".
                                                                                                                                                                                                       
The OU  OU=ServiceAccounts,DC=SpAzure,DC=com  already exists.
Current subscription: Windows Azure MSDN - Visual Studio Ultimate
Creating VM...
Adding disk Log with size 10
                                                                                                                                                                                                       
Adding Endpoint
                                                                                                                                                                                                       
Adding Endpoint
                                                                                                                                                                                                       
[VERBOSE] 4:12:49 PM - Completed Operation: Get Deployment
[VERBOSE] 4:12:49 PM - Begin Operation: New-AzureVM - Create VM SpAllInOne
[VERBOSE] 4:13:52 PM - Completed Operation: New-AzureVM - Create VM SpAllInOne
                                                                                                                                                                                                       
[VERBOSE] 4:13:52 PM - InstanceStatus is RoleStateUnknown
[VERBOSE] 4:15:56 PM - InstanceStatus is Provisioning
[VERBOSE] 4:18:00 PM - InstanceStatus is ReadyRole
VM created.
Installing WinRM Certificate for remote access: SpAzureService SpAllInOne
Pausing for Services to Start
Formatting data disks

Microsoft DiskPart version 6.2.9200

Copyright (C) 1999-2012 Microsoft Corporation.
On computer: SPALLINONE

Disk 2 is now the selected disk.

Virtual Disk Service error:
This disk is already online. 


Disk attributes cleared successfully.

DiskPart succeeded in creating the specified partition.


    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
    0 percent completed
  100 percent completed


DiskPart successfully formatted the volume.
Enabling CredSSP on SpAllInOne
Enabling CredSSP Server...
Auth
    Basic = false
    Kerberos = true
    Negotiate = true
    Certificate = false
    CredSSP = true
    CbtHardeningLevel = Relaxed

CredSSP Server is enabled.
Pausing to Allow CredSSP to be enabled on SpAllInOne
[ERROR] [spazureservice.cloudapp.net] Connecting to remote server spazureservice.cloudapp.net failed with the following error message : The WinRM client cannot process the request. CredSSP authentication is 
[ERROR] currently disabled in the client configuration. Change the client configuration and try the request again. CredSSP authentication must also be enabled in the server configuration. Also, Group Policy 
[ERROR] must be edited to allow credential delegation to the target computer. Use gpedit.msc and look at the following policy: Computer Configuration -> Administrative Templates -> System -> Credentials 
[ERROR] Delegation -> Allow Delegating Fresh Credentials.  Verify that it is enabled and configured with an SPN appropriate for the target computer. For example, for a target computer name 
[ERROR] "myserver.domain.com", the SPN can be one of the following: WSMAN/myserver.domain.com or WSMAN/*.domain.com For more information, see the about_Remote_Troubleshooting Help topic.
[ERROR]     + CategoryInfo          : OpenError: (spazureservice.cloudapp.net:String) [], PSRemotingTransportException
[ERROR]     + FullyQualifiedErrorId : -2144108126,PSSessionStateBroken
[ERROR] New-PSSession : [spazureservice.cloudapp.net] Connecting to remote server spazureservice.cloudapp.net failed with the following error message : The WinRM client cannot process the request. CredSSP 
[ERROR] authentication is currently disabled in the client configuration. Change the client configuration and try the request again. CredSSP authentication must also be enabled in the server configuration. 
[ERROR] Also, Group Policy must be edited to allow credential delegation to the target computer. Use gpedit.msc and look at the following policy: Computer Configuration -> Administrative Templates -> System 
[ERROR] -> Credentials Delegation -> Allow Delegating Fresh Credentials.  Verify that it is enabled and configured with an SPN appropriate for the target computer. For example, for a target computer name 
[ERROR] "myserver.domain.com", the SPN can be one of the following: WSMAN/myserver.domain.com or WSMAN/*.domain.com For more information, see the about_Remote_Troubleshooting Help topic.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SharePoint\ProvisionSharePoint.ps1:126 char:13
[ERROR] +     $session = New-PSSession -ComputerName $spuris[0].DnsSafeHost -Credential $cred ...
[ERROR] +    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[ERROR]     + CategoryInfo          : OpenError: (System.Manageme....RemoteRunspace:RemoteRunspace) [New-PSSession], PSRemotingTransportException
[ERROR]     + FullyQualifiedErrorId : -2144108126,PSSessionOpenFailed
[ERROR] Invoke-Command : Cannot validate argument on parameter 'Session'. The argument is null or empty. Provide an argument that is not null or empty, and then try the command again.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SharePoint\ProvisionSharePoint.ps1:131 char:33
[ERROR] +         Invoke-Command -session $session -ArgumentList $webApp.Name, $config.Azu ...
[ERROR] +                                 ~~~~~~~~
[ERROR]     + CategoryInfo          : InvalidData: (:) [Invoke-Command], ParameterBindingValidationException
[ERROR]     + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.PowerShell.Commands.InvokeCommandCommand
[ERROR]  
[ERROR] Remove-PSSession : Cannot validate argument on parameter 'Id'. The argument is null. Provide a valid value for the argument, and then try running the command again.
[ERROR] At C:\Repos\SPAzurePoSh\SPAzurePoSh\azure-scripts - Mario Customized\AutomatedDeployments\SharePoint\ProvisionSharePoint.ps1:168 char:19
[ERROR] +     Remove-PSSession $session
[ERROR] +                      ~~~~~~~~
[ERROR]     + CategoryInfo          : InvalidData: (:) [Remove-PSSession], ParameterBindingValidationException
[ERROR]     + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.PowerShell.Commands.RemovePSSessionCommand
[ERROR]  
Script Execution Complete. Verify no errors during execution.
Credentials: SpAzure\SpAzureAdmin Password: P@ssword1
Created Farm on http://SpAzureService.cloudapp.net
Created Admin Site on http://SpAzureService.clouadpp.net:20000
End Deployment 07/08/2014 16:26:20


The program 'master-deployment-script.ps1: PowerShell Script' has exited with code 0 (0x0).
